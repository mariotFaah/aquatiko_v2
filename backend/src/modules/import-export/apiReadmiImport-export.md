# üì¶ Module Import/Export - Aquatiko

![Module Status](https://img.shields.io/badge/status-production-brightgreen) ![Node Version](https://img.shields.io/badge/node-16%2B-blue) ![License](https://img.shields.io/badge/license-Aquatiko-blueviolet)

## üåü Aper√ßu

Module complet de gestion des op√©rations **import/export** pour Aquatiko.  
Permet un suivi complet des commandes clients/fournisseurs, des exp√©ditions et des co√ªts logistiques, avec calcul automatique des marges et int√©gration comptable.

---

## üìë Table des Mati√®res

- [Fonctionnalit√©s](#-fonctionnalit√©s)
- [Installation et Configuration](#-installation-et-configuration)
- [API Documentation](#-api-documentation)
- [Structure de la Base de Donn√©es](#-structure-de-la-base-de-donn√©es)
- [Exemples d‚ÄôUtilisation](#-exemples-dutilisation)
- [Formules de Calcul](#-formules-de-calcul)
- [Architecture Technique](#-architecture-technique)
- [Tests et Validation](#-tests-et-validation)
- [S√©curit√© et Validation](#-s√©curit√©-et-validation)
- [Statut du Module](#-statut-du-module)
- [D√©veloppement et Contribution](#-d√©veloppement-et-contribution)
- [Support et Maintenance](#-support-et-maintenance)

---

## üöÄ Fonctionnalit√©s

### Gestion des commandes
- ‚úÖ Import/export
- ‚úÖ Num√©rotation automatique (`CMD-000001`)
- ‚úÖ Workflow : `brouillon ‚Üí confirm√©e ‚Üí exp√©di√©e ‚Üí livr√©e ‚Üí annul√©e`
- ‚úÖ Lignes d√©taill√©es avec articles
- ‚úÖ Calculs automatiques (montants, TVA, totaux)
- ‚úÖ Int√©gration tiers (clients/fournisseurs)

### Suivi des exp√©ditions
- ‚úÖ Gestion documents : BL, connaissement, packing list
- ‚úÖ Dates d‚Äôexp√©dition et d‚Äôarriv√©e pr√©vue
- ‚úÖ Statuts : `pr√©paration ‚Üí exp√©di√©e ‚Üí transit ‚Üí arriv√©e ‚Üí livr√©e`
- ‚úÖ Informations transporteur et mode transport
- ‚úÖ Cr√©ation/modification exp√©dition apr√®s cr√©ation commande

### Co√ªts logistiques
- ‚úÖ Fret maritime/a√©rien
- ‚úÖ Assurance
- ‚úÖ Droits de douane
- ‚úÖ Frais de transit et transport local
- ‚úÖ Autres frais
- ‚úÖ Devise param√©trable

### Calcul de marges
- ‚úÖ Marge brute et nette calcul√©es automatiquement
- ‚úÖ Prise en compte des co√ªts logistiques
- ‚úÖ Taux de marge en %
- ‚úÖ Analyse de rentabilit√© par commande
- ‚úÖ Mise √† jour en temps r√©el

---

## üõ†Ô∏è Installation et Configuration

### Pr√©requis
- Node.js 16+
- MySQL / MariaDB
- Module Comptabilit√© install√©
- Tables `tiers` et `articles` peupl√©es

### Installation
```bash
# Ex√©cuter les migrations Knex
npx knex migrate:latest

# V√©rifier le statut
npx knex migrate:status
üåê API Documentation

Base URL : http://localhost:3001/api/import-export

Commandes
| M√©thode | Endpoint              | Description                          |
| ------- | --------------------- | ------------------------------------ |
| GET     | /commandes            | Liste toutes les commandes           |
| GET     | /commandes/:id        | D√©tail d‚Äôune commande avec relations |
| POST    | /commandes            | Cr√©er une nouvelle commande          |
| PATCH   | /commandes/:id/statut | Mettre √† jour le statut              |

Exp√©ditions
| M√©thode | Endpoint              | Description                           |
| ------- | --------------------- | ------------------------------------- |
| POST    | /commandes/expedition | Cr√©er ou mettre √† jour une exp√©dition |

Co√ªts Logistiques
| M√©thode | Endpoint         | Description                                        |
| ------- | ---------------- | -------------------------------------------------- |
| POST    | /commandes/couts | Enregistrer ou mettre √† jour les co√ªts logistiques |

Calcul de marge
| M√©thode | Endpoint             | Description                      |
| ------- | -------------------- | -------------------------------- |
| GET     | /commandes/:id/marge | Calculer la marge d‚Äôune commande |

üíæ Structure de la Base de Donn√©es
Table commandes
| Champ           | Type                                                        | Description        | Obligatoire |
| --------------- | ----------------------------------------------------------- | ------------------ | ----------- |
| id              | INT UNSIGNED AUTO_INCREMENT                                 | ID unique          | ‚úÖ           |
| numero_commande | VARCHAR(255) UNIQUE                                         | Num√©ro auto        | ‚úÖ           |
| type            | ENUM('import','export')                                     | Type               | ‚úÖ           |
| client_id       | INT UNSIGNED                                                | R√©f√©rence tiers.id | ‚úÖ           |
| fournisseur_id  | INT UNSIGNED                                                | R√©f√©rence tiers.id | ‚úÖ           |
| date_commande   | DATE                                                        | Date commande      | ‚úÖ           |
| statut          | ENUM('brouillon','confirm√©e','exp√©di√©e','livr√©e','annul√©e') | Workflow           | ‚úÖ           |
| montant_total   | DECIMAL(15,2)                                               | Calcul automatique | ‚úÖ           |
| devise          | VARCHAR(3)                                                  | EUR, USD, MGA      | ‚úÖ           |
Table lignes_commande
| Champ         | Type                        | Description                     | Obligatoire |
| ------------- | --------------------------- | ------------------------------- | ----------- |
| id            | INT UNSIGNED AUTO_INCREMENT | ID unique                       | ‚úÖ           |
| commande_id   | INT UNSIGNED                | Commande parente                | ‚úÖ           |
| article_id    | VARCHAR(50)                 | R√©f√©rence articles.code_article | ‚úÖ           |
| description   | VARCHAR(255)                | Description produit             | ‚úÖ           |
| quantite      | DECIMAL(10,2)               | Quantit√©                        | ‚úÖ           |
| prix_unitaire | DECIMAL(15,2)               | Prix unitaire                   | ‚úÖ           |
| taux_tva      | DECIMAL(5,2)                | TVA (%)                         | ‚úÖ           |
Table expeditions
| Champ                | Type                                                        | Description          | Obligatoire |
| -------------------- | ----------------------------------------------------------- | -------------------- | ----------- |
| id                   | INT UNSIGNED AUTO_INCREMENT                                 | ID unique            | ‚úÖ           |
| commande_id          | INT UNSIGNED                                                | Commande associ√©e    | ‚úÖ           |
| numero_bl            | VARCHAR(255)                                                | Num√©ro BL            | ‚ùå           |
| numero_connaissement | VARCHAR(255)                                                | Num√©ro connaissement | ‚ùå           |
| numero_packing_list  | VARCHAR(255)                                                | Num√©ro packing list  | ‚ùå           |
| date_expedition      | DATE                                                        | Date exp√©dition      | ‚ùå           |
| date_arrivee_prevue  | DATE                                                        | Date arriv√©e pr√©vue  | ‚ùå           |
| transporteur         | VARCHAR(255)                                                | Transporteur         | ‚ùå           |
| mode_transport       | VARCHAR(50)                                                 | Mode transport       | ‚ùå           |
| statut               | ENUM('preparation','exp√©di√©e','transit','arriv√©e','livr√©e') | Statut               | ‚úÖ           |
Table couts_logistiques
| Champ           | Type                        | Description       | Obligatoire |
| --------------- | --------------------------- | ----------------- | ----------- |
| id              | INT UNSIGNED AUTO_INCREMENT | ID unique         | ‚úÖ           |
| commande_id     | INT UNSIGNED                | Commande associ√©e | ‚úÖ           |
| fret_maritime   | DECIMAL(15,2)               | Fret maritime     | ‚ùå           |
| fret_aerien     | DECIMAL(15,2)               | Fret a√©rien       | ‚ùå           |
| assurance       | DECIMAL(15,2)               | Assurance         | ‚ùå           |
| droits_douane   | DECIMAL(15,2)               | Droits douane     | ‚ùå           |
| frais_transit   | DECIMAL(15,2)               | Frais transit     | ‚ùå           |
| transport_local | DECIMAL(15,2)               | Transport local   | ‚ùå           |
| autres_frais    | DECIMAL(15,2)               | Autres frais      | ‚ùå           |
| devise_couts    | VARCHAR(3)                  | Devise co√ªts      | ‚úÖ           |
üìã Exemples d‚ÄôUtilisation
Cr√©ation d‚Äôune commande d‚Äôimport
curl -X POST http://localhost:3001/api/import-export/commandes \
-H "Content-Type: application/json" \
-d '{
  "type": "import",
  "client_id": 1,
  "fournisseur_id": 2,
  "date_commande": "2024-01-15",
  "lignes": [
    {
      "article_id": "ART001",
      "description": "Ordinateur Portable",
      "quantite": 2,
      "prix_unitaire": 2500000,
      "taux_tva": 20
    }
  ]
}'
Mise √† jour du statut
curl -X PATCH http://localhost:3001/api/import-export/commandes/4/statut \
-H "Content-Type: application/json" \
-d '{"statut": "confirm√©e"}'
Enregistrement des co√ªts logistiques
curl -X POST http://localhost:3001/api/import-export/commandes/couts \
-H "Content-Type: application/json" \
-d '{
  "commande_id": 4,
  "fret_maritime": 500000,
  "assurance": 100000,
  "droits_douane": 300000,
  "transport_local": 200000
}'
Calcul de marge
curl http://localhost:3001/api/import-export/commandes/4/marge
R√©ponse type :
{
  "success": true,
  "message": "Calcul de marge effectu√© avec succ√®s",
  "data": {
    "marge_brute": "4900000.00",
    "marge_nette": "4900000.00",
    "taux_marge": 81.67,
    "total_couts": "1100000.00",
    "chiffre_affaires": "6000000.00"
  }
}
üìê Formules de Calcul

Montant total commande
total = Œ£(ligne.quantite * ligne.prix_unitaire * (1 + ligne.taux_tva/100))

Total co√ªts logistiques
total_couts = fret_maritime + fret_aerien + assurance + droits_douane + frais_transit + transport_local + autres_frais
Marge brute
marge_brute = montant_total_commande - total_couts_logistiques
Taux de marge
taux_marge = (marge_brute / montant_total_commande) * 100
üîß Architecture Technique
src/modules/import-export/
‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îî‚îÄ‚îÄ CommandeController.js
‚îú‚îÄ‚îÄ entities/
‚îÇ   ‚îú‚îÄ‚îÄ Commande.js
‚îÇ   ‚îú‚îÄ‚îÄ LigneCommande.js
‚îÇ   ‚îú‚îÄ‚îÄ Expedition.js
‚îÇ   ‚îî‚îÄ‚îÄ CoutLogistique.js
‚îú‚îÄ‚îÄ repositories/
‚îÇ   ‚îú‚îÄ‚îÄ CommandeRepository.js
‚îÇ   ‚îú‚îÄ‚îÄ ExpeditionRepository.js
‚îÇ   ‚îî‚îÄ‚îÄ CoutLogistiqueRepository.js
‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îú‚îÄ‚îÄ CommandeService.js
‚îÇ   ‚îú‚îÄ‚îÄ ExpeditionService.js
‚îÇ   ‚îî‚îÄ‚îÄ CalculMargeService.js
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îú‚îÄ‚îÄ index.js
‚îÇ   ‚îî‚îÄ‚îÄ commandes.routes.js
‚îî‚îÄ‚îÄ index.js


Workflow m√©tier :
Cr√©ation Commande ‚Üí Validation ‚Üí Exp√©dition ‚Üí Arriv√©e ‚Üí Facturation ‚Üí Calcul Marge
     ‚Üì              ‚Üì           ‚Üì           ‚Üì           ‚Üì           ‚Üì
 Brouillon      Confirm√©e   Exp√©di√©e    Arriv√©e     Livr√©e     Analyse


üß™ Tests et Validation

V√©rifier les donn√©es de test :

2 clients minimum dans tiers

2 fournisseurs minimum dans tiers

Articles avec code_article

Test de sant√© :
curl http://localhost:3001/api/health
Test cr√©ation et r√©cup√©ration commande :
curl -X POST http://localhost:3001/api/import-export/commandes \
-H "Content-Type: application/json" \
-d '{"type":"import","client_id":1,"fournisseur_id":2,"date_commande":"2024-01-15"}'
curl http://localhost:3001/api/import-export/commandes
üîí S√©curit√© et Validation

Validation stricte des entr√©es

Gestion des transactions

Contr√¥le d‚Äôint√©grit√© r√©f√©rentielle

Logs centralis√©s

Gestion des erreurs robuste

üö¶ Statut du Module

Gestion commandes : ‚úÖ 100%

Suivi exp√©ditions : ‚úÖ 100%

Co√ªts logistiques : ‚úÖ 100%

Calcul marges : ‚úÖ 100%

Pr√™t pour production

üë• D√©veloppement et Contribution

Commandes utiles :
# Mode d√©veloppement
npm run dev

# Nouvelles migrations
npx knex migrate:make nom_migration

# Ex√©cution migrations
npx knex migrate:latest

Standards de code :

Modules ES6+

Async/await pour op√©rations asynchrones

Validation des entr√©es

Gestion centralis√©e des erreurs

üìû Support et Maintenance

Pour toute question, contacter l‚Äô√©quipe de d√©veloppement Aquatiko.
¬© 2025 Aquatiko - Tous droits r√©serv√©s